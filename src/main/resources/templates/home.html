<!-- templates/home.html -->
<section th:fragment="content"
         xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

  <h2 class="mb-4">나의 체중 추이</h2>

  <canvas id="weightChart" height="120"></canvas>

  <div id="__meta" th:data-userid="${userId}"></div>

  <div class="mt-4 d-flex justify-content-between">
    <a class="btn btn-primary-green" th:href="@{/weight-log/form}">새 몸무게 기록</a>
    <a class="btn btn-outline-secondary" th:href="@{/feedback}">GPT 피드백 받기</a>
  </div>

  <div sec:authorize="isAuthenticated()" class="mt-5">
    <h2 th:text="'안녕하세요, ' + (${userName} ?: '회원') + ' 님!'"></h2>
    <a class="btn btn-primary-green btn-lg mt-3" href="#" data-bs-toggle="modal" data-bs-target="#mealModal">
      식단 등록하기
    </a>
  </div>

  <!-- ===== 식단 입력 모달 ===== -->
  <div class="modal fade" id="mealModal" tabindex="-1" aria-labelledby="mealModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content p-3">
        <h5 class="modal-title mb-3">식단 등록</h5>

        <form id="mealForm">
          <div class="mb-2">
            <label for="mealTime" class="form-label">식사 종류</label>
            <select class="form-select" id="mealTime" required>
              <option value="BREAKFAST">아침</option>
              <option value="LUNCH">점심</option>
              <option value="DINNER">저녁</option>
              <option value="SNACK">간식</option>
            </select>
          </div>

          <div class="mb-2">
            <label for="eatenAt" class="form-label">섭취 시간</label>
            <input type="datetime-local" class="form-control" id="eatenAt" required />
          </div>

          <div id="foodItemsContainer"></div>

          <button type="button" class="btn btn-sm btn-outline-secondary mb-2" id="addFoodItemBtn">+ 음식 추가</button>

          <div class="d-flex justify-content-between mt-3">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
            <button type="submit" class="btn btn-primary">등록</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="mt-4">
    <button class="btn btn-outline-primary" id="targetCalBtn">하루 권장 칼로리 보기</button>
  </div>

  <div id="targetCalResult" class="mt-3"></div>

  <script src="/webjars/chartjs/4.4.2/dist/chart.umd.js"></script>
  <script src="/js/weight-chart.js"></script>
  <script src="/js/meal-register.js"></script>
</section>